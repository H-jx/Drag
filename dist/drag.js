!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Drag=e()}(this,function(){"use strict";function l(t){return"function"==typeof t}function h(t){return new RegExp("("+t+")\\([0-9]+.?[0-9]*(px)\\)")}function o(t){function e(t,e){var n=t.exec(e);if(null===n)return"";var s=n[0];return s.substring(s.indexOf("(")+1,s.indexOf(")"))}var n=h("translateX"),s=h("translateY"),i=/(translate)\([0-9]+\.?[0-9]*(px)\,\s?[0-9]+\.?[0-9]*(px)\)/,o={translateX:0,translateY:0};if(n.test(t)&&(o.translateX=parseFloat(e(n,t))),s.test(t)&&(o.translateY=parseFloat(e(s,t))),i.test(t)){var r=e(i,t).split(",");o.translateX=parseFloat(r[0]),o.translateY=parseFloat(r[1])}return o}function t(t,e){this.x=0,this.y=0,this.events={},this.disX=0,this.disY=0,this.opts=e||{},this.init(t)}return t.prototype.destroy=function(){this.dragTarget.removeEventListener("mousedown",this.handleDown),this.dragTarget.removeEventListener("touchstart",this.handleDown)},t.prototype.init=function(t){if(!(t instanceof HTMLElement))throw Error("未传el[must be a HTMLHTMLElement]");this.el=t,this.dragTarget=this.opts.dragTarget||t,this.opts.useTransform=void 0===this.opts.useTransform||this.opts.useTransform,this.events=this.opts.events||{},this.x=this.opts.x||0,this.y=this.opts.y||0,this.handleMove=this.handleMove.bind(this),this.handleDown=this.handleDown.bind(this),this.handleUp=this.handleUp.bind(this),this.bindTouchStartEvents(),this.opts.useTransform||"absolute"===function(t){return getComputedStyle(t,null)}(this.el).position||(this.el.style.position="absolute")},t.prototype.bindTouchStartEvents=function(){this.dragTarget.addEventListener("mousedown",this.handleDown,!1),this.dragTarget.addEventListener("touchstart",this.handleDown,!1)},t.prototype.bindMoveEvents=function(){document.addEventListener("mousemove",this.handleMove,!1),document.addEventListener("touchmove",this.handleMove,!1)},t.prototype.handleDown=function(t){var e=0,n=0;if("touchstart"===t.type){var s=t.touches[0];e=s.clientX,n=s.clientY}else e=t.clientX,n=t.clientY;if(this.opts.useTransform){var i=o(this.el.style.transform||"");this.disX=e-i.translateX,this.disY=n-i.translateY}else this.disX=e-this.el.offsetLeft,this.disY=n-this.el.offsetTop;l(this.events.onDown)&&!1===this.events.onDown(t,this)||(this.bindMoveEvents(),document.addEventListener("mouseup",this.handleUp),document.addEventListener("touchend",this.handleUp))},t.prototype.handleMove=function(t){var e=this;if("touchmove"===t.type){t.preventDefault();var n=t.touches[0];e.x=n.clientX-e.disX,e.y=n.clientY-e.disY}else e.x=t.clientX-e.disX,e.y=t.clientY-e.disY;if(this.opts.container instanceof HTMLElement){var s=this.opts.container.getBoundingClientRect(),i=this.el.clientWidth,o=this.el.clientHeight,r=this.el.getBoundingClientRect(),h=r.x,a=r.y;h<s.left&&(e.x=s.left),a<s.y&&(e.y=s.y),a>s.bottom-o&&(e.y=s.bottom-o),h>s.right-i&&(e.x=s.right-i)}l(this.events.onMove)&&!1===this.events.onMove(t,e)||(this.opts.useTransform?e.el.style.transform="translate("+e.x+"px,"+e.y+"px)":(e.el.style.left=e.x+"px",e.el.style.top=e.y+"px"),t.preventDefault())},t.prototype.handleUp=function(t){l(this.events.onUp)&&!1===this.events.onUp(t,this)||(document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("touchmove",this.handleMove),document.removeEventListener("mouseup",this.handleUp),document.removeEventListener("touchend",this.handleUp))},t.paserTransform=o,t});
